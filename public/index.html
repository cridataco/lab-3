<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitor de Nodo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1, h2 {
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: auto;
    }
    .info-section, .logs-section {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .logs-section ul {
      list-style: none;
      padding: 0;
      max-height: 200px;
      overflow-y: auto;
    }
    .log-entry {
      font-size: 0.9em;
      color: #555;
      margin: 4px 0;
      border-bottom: 1px solid #eee;
      padding-bottom: 4px;
    }
    .status {
      font-weight: bold;
      color: green;
    }
    .status.offline {
      color: red;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Monitor de Nodo</h1>

    <div class="info-section">
      <h2>Información del Nodo</h2>
      <p><strong>ID:</strong> <span id="node-id">Cargando...</span></p>
      <p><strong>Puerto:</strong> <span id="node-port">Cargando...</span></p>
      <p><strong>Estado:</strong> <span id="node-status" class="status">Cargando...</span></p>
      <p><strong>Líder Actual:</strong> <span id="node-leader">Cargando...</span></p>
    </div>

    <div class="logs-section">
      <h2>Logs</h2>
      <ul id="log-list">
        <!-- Aquí se agregan los logs dinámicamente -->
      </ul>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io(); // Conexión con el monitor
    const nodeId = parseInt(new URLSearchParams(window.location.search).get('id')) || 1;
    const nodePort = 4000 + nodeId;

    // Elementos de la interfaz
    const nodeIdElement = document.getElementById('node-id');
    const nodePortElement = document.getElementById('node-port');
    const nodeStatusElement = document.getElementById('node-status');
    const nodeLeaderElement = document.getElementById('node-leader');
    const logListElement = document.getElementById('log-list');

    // Inicializar datos del nodo
    nodeIdElement.textContent = nodeId;
    nodePortElement.textContent = nodePort;

    socket.on('updateNodos', (nodos) => {
      const nodo = nodos.find(n => n.id === nodeId);

      if (nodo) {
        nodeStatusElement.textContent = nodo.estado === 'activo' ? 'Activo' : 'Inactivo';
        nodeStatusElement.className = `status ${nodo.estado === 'activo' ? '' : 'offline'}`;
        nodeLeaderElement.textContent = nodo.esLider ? 'Este Nodo' : `Nodo ${nodos.find(n => n.esLider)?.id || 'Ninguno'}`;
      } else {
        nodeStatusElement.textContent = 'No Registrado';
        nodeStatusElement.className = 'status offline';
        nodeLeaderElement.textContent = 'Desconocido';
      }
    });

    socket.on('newLog', (log) => {
      const logEntry = document.createElement('li');
      logEntry.textContent = log;
      logEntry.className = 'log-entry';
      logListElement.appendChild(logEntry);

      if (logListElement.childElementCount > 50) {
        logListElement.removeChild(logListElement.firstChild);
      }
    });

    // Simular estado del nodo
    socket.emit('updateNodos', [{ id: nodeId, estado: 'activo', esLider: false }]);
  </script>
</body>
</html>
